# ONE APP 白嫖脚本

这是一套用于自动获取ONE APP免费内容的脚本集合。

## 环境要求

运行此脚本所需外部库：
```bash
pip install pycryptodome httpx
```

本脚本按照可独立运行的Python方式编写，支持从青龙面板、宝塔面板运行。

## 定时任务设置

支持从青龙面板运行，建议设置定时Cron：
| 脚本文件 | Cron表达式 | 说明 |
|---------|-----------|------|
| freeBuy.py | */30 * * * * | 每30分钟执行一次，自动购买免费内容 |
| freePlug.py | 0 8 1,2 * * | 每月1号和2号8点执行，补充历史免费内容 |
| buyPusher.py | 50 23 * * * | 每天23:50执行，推送当天的白嫖记录 |

## 更新内容（25/04/03）
1. 新增自动切换API接口功能，防止白嫖失败。
2. 新增getToken.py和freeBuy.py检测配置文件功能，如不存在配置文件自动新增。
3. 新增白嫖记录文件超过200条时自动清理前100条记录。
4. 完善报错提示，避免某些报错会导致脚本直接退出的情况。
5. 完善getToken.py获取Token数据的流程。
6. 移除更新token时获取不必要的配置项数据。
7. 移除pyyaml库支持，改为使用json库(Python自带的标准库)读写配置信息。

![undefined](https://y.gtimg.cn/music/photo_new/T053M000000IRiEl0wCJ0O.png)

## 使用说明

1. 首先通过各种渠道下载ONE APP：[下载链接](https://2f2279ygf3x29x.icu?code=jqJ9txPeVS)  
   下载后登录账号。

2. 获取配置信息（两种方式）：
   - **方式一**：在电脑上执行`getToken.py`，直接输入手机号接收验证码即可自动完成Token获取并填入配置文件。
   - **方式二**：通过抓包获取。抓包工具推荐：手机端可用黄鸟，电脑端可用Fiddler Everywhere。开启抓包后点击APP的个人中心，从请求头中获取`uuid`、`user-key`、`token`，并填入`config.json`中对应项(如果没有config.json文件可以运行getToken.py或freeBuy.py自动创建)。

3. 配置推送功能（可选）：
   在`config.json`中配置wxpusher的token和uid（不填的话也能运行，只是没有推送功能）。

## 脚本功能说明

### getToken.py
只需要输入手机号即可自动填入账号信息。在电脑上运行后会创建默认配置文件，输入手机号登录成功后即可运行白嫖脚本，也适用于未注册的号码，可以直接接收验证码完成注册并登录。

### freeBuy.py
集成自动更新token（更新token失败会通过wxpusher推送）、自动扫描点播列表、自动购买0元点播视频、写入白嫖记录功能。

### freePlug.py
补充历史白嫖点播，往期的付费点播可能会修改为免费，可以通过每月1、2号（或每周一）运行此脚本进行补充。脚本运行后会扫描往期所有的点播，运行耗时比较长（约1.5小时左右）。新账号如果出现未知报错，可能是一次性购买太多项目超时的原因，重新运行一次脚本即可（常见的报错都会进行等待、重试或者跳过）。

### buyPusher.py
用于推送当天的白嫖记录（只能推送当天的记录，所以一定要在0点前完成推送）。如果没有配置wxpusher的话就不需要运行。

## 注意事项

1. 首次运行时，如果`config.json`不存在，脚本会自动创建默认配置文件。
2. 重要配置项：`TOKEN`、`USER_KEY`、`UUID`这三项是必填的，必须填写有效值才能运行脚本。
3. 脚本会自动记录购买历史，并存储在`buyrecord.json`文件中。
4. 运行脚本后`config.json`中的token会被自动刷新，抓包一次即可永久白嫖。